<?xml version="1.0" encoding="iso-8859-15"?>
<coll name="ContentdatosCalendario" title="calendario" xloadall="true" sql="select t1.ID,t1.FECHA,t1.TIPO,t1.DESCRIPCION,  case    when TIPO='Info: Azul' then '#8AA3FB'    when TIPO='Visita: Naranja' then '#FBCC8A'   when TIPO='Pedido: Verde' then '#8AFB95'  end as MAP_COLORVIEW,   case    when t1.HORAINI is null then '19:00'   else HORAINI end as HORAINI, case    when t1.HORAFIN is null then '23:00'  else HORAFIN end as HORAFIN, t1.FECHA as MAP_FECHA, t1.DESCRIPCION as MAP_DESCRIPCION from ##PREF##tareas t1" objname="tareas" updateobj="tareas" progid="ASData.CASBasicDataObj">
  <group name="HEADER" id="10" class="groupfixed_header" />
  <frame group="10" name="frmtitulo" class="frmsuperior" />
  <prop group="10" frame="frmtitulo" name="SALIR" type="B" class="btvolversuper" />
  <prop group="10" frame="frmtitulo" name="MENU" type="TL" class="tlsuper" title="DATOS CALENDARIO" />
  <prop group="10" frame="frmtitulo" name="MAP_COLORACTIVO" type="T" visible="0" />
  <group name="FOOTER" id="0" class="groupfixed_footer" />
  <prop group="0" name="MAP_IDLINEA" type="N" visible="0" />
  <prop group="0" name="MAP_GROUP" type="N" visible="0" />
  <prop group="0" name="MAP_TOTAL_PAGES" type="N" visible="0" />
  <frame group="0" name="FLOAT_FOOTER_FRAME" class="frmsuperior" />
  <prop group="0" frame="FLOAT_FOOTER_FRAME" name="MAP_CANCELAR" type="B" labelwidth="0" width="100%" bgcolor="#00000000" locked="true" />
  <group name="General" id="1" />
  <frame group="1" name="frmgrid" width="100%" />
  <prop group="1" frame="frmgrid" name="MAP_FECHA" type="D" visible="4" labelwidth="0" width="200p" text-align="center" textfont-size="8" />
  <prop group="1" frame="frmgrid" name="MAP_DESCRIPCION" type="T" visible="4" labelwidth="0" width="520p" text-align="center" textfont-size="8" newline="false" />
  <frame group="1" name="frmTitleCalendario" height="100%" align="center|top" width="96%" lmargin="2%" animation-in="##PUSH_IN##" animation-out="##ROTATE3D_OUT##" />
  <prop group="1" frame="frmTitleCalendario" name="FECHA" type="D" visible="1" datefrom="true" dateto="true" title="Fecha:" class="classdate" />
  <prop group="1" frame="frmTitleCalendario" name="MAP_TIPO" type="T" mapcol-values="Info: Azul,Visita: Naranja,Pedido: Verde" visible="0" />
  <prop group="1" frame="frmTitleCalendario" name="HORAINI" type="TT" mask="Hh#:#Mm" visible="1" timefrom="true" title="Hora Inicio:" class="classtime" />
  <prop group="1" frame="frmTitleCalendario" name="HORAFIN" timeto="true" type="TT" visible="1" mask="Hh#:#Mm" title="Hora Fin:" class="classtime" />
  <prop group="1" frame="frmTitleCalendario" name="TIPO" type="T" showinline="true" class="classT" visible="1" title="Tipo:" linkedto="MAP_TIPO" linkedfield="DATA" onchange="refresh(TIPO)" />
  <prop group="1" frame="frmTitleCalendario" name="DESCRIPCION" type="T" visible="1" title="Descripción:" class="classTMultiline" />
  <prop group="1" frame="frmTitleCalendario" name="MAP_COLORVIEW" type="T" visible="0" colorview="true" />
  <prop group="1" frame="frmTitleCalendario" name="MAP_BUTCANCELAR" type="B" caption="CANCELAR" class="btnButton" method="ExecuteNode(onback)" />
  <prop group="1" frame="frmTitleCalendario" name="MAP_BUTACEPTAR" type="B" caption="ACEPTAR" class="btnButton" method="ExecuteNode(guardar)" newline="false" />
  <befored-edit>
    <action name="runscript">
      <script language="javascript">
				self.MAP_COLORACTIVO = "#666666";
			</script>
    </action>
  </befored-edit>
  <create>
    <action name="runscript">
      <script language="javascript">
				self.MAP_COLORACTIVO = "#666666";
			</script>
    </action>
  </create>
  <ondateselected refresh="true" show-wait-dialog="false" refresh-owner="MAP_FECHA,MAP_TITLE_NAME_MES,MAP_TITLE_ANO,BEdit,BDelete">
    <action name="runscript">
      <param name="DATEVALUE" />
      <param name="TIMEVALUE" />
      <param name="EVENTVALUE" />
      <script language="javascript">
                var monthName = new Array("Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre");
				selfDataColl.getOwnerObject().MAP_FECHA = DATEVALUE;
				selfDataColl.getOwnerObject().MAP_TITLE_NAME_MES = monthName[DATEVALUE.getMonth()].toString().toUpperCase();
				selfDataColl.getOwnerObject().MAP_TITLE_ANO = DATEVALUE.getFullYear().toString();
				var coll = appData.getCollection("ContentTareas");
				var obj;
				if (appData.getGlobalMacro("##DEVICE_OS##")==="web") {
				    obj = coll.findObject("DATE_FORMAT(t1.FECHA, '%M %d %Y')=DATE_FORMAT('" + DATEVALUE.toString() + "','%M %d %Y')");
				} else {
				    obj = coll.findObject("strftime('%Y-%m-%d',t1.FECHA)=strftime('%Y-%m-%d','" + DATEVALUE.toString() + "')");
				}
				
				
				if ( obj == null){
					selfDataColl.getOwnerObject().MAP_IDTAREASELECTED= 0;
					selfDataColl.getOwnerObject().MAP_VER= 0;
				}else{
					selfDataColl.getOwnerObject().MAP_IDTAREASELECTED = obj.ID;
					selfDataColl.getOwnerObject().MAP_SELECCIONADO = obj.MAP_DESCRIPCION;
					selfDataColl.getOwnerObject().MAP_VER = 1;
				}
			</script>
    </action>
  </ondateselected>
  <onpageselected refresh="true" show-wait-dialog="false" refresh-owner="MAP_FECHA,MAP_TITLE_NAMES_MES,MAP_TITLE_ANO,BEdit,BDelete">
    <action name="runscript">
      <param name="DATEVALUE" />
      <param name="CURRENT" />
      <param name="DATEFROM" />
      <param name="TOTALDAYS" />
      <script language="javascript">
				var monthName = new Array("Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre");
				selfDataColl.getOwnerObject().MAP_FECHA = DATEVALUE;
				selfDataColl.getOwnerObject().MAP_TITLE_NAME_MES = monthName[DATEVALUE.getMonth()].toString().toUpperCase();
				selfDataColl.getOwnerObject().MAP_TITLE_ANO = DATEVALUE.getFullYear().toString();
				selfDataColl.getOwnerObject().MAP_VER = 0;
			</script>
    </action>
  </onpageselected>
  <onback show-wait-dialog="false">
    <action name="runscript">
      <script language="javascript">
				appData.failWithMessage(-11888,"##EXIT##");
			</script>
    </action>
  </onback>
  <guardar show-wait-dialog="false">
    <action name="runscript">
      <script language="javascript">
				self.save();
				appData.failWithMessage(-11888,"##EXIT##");
			</script>
    </action>
  </guardar>
</coll>